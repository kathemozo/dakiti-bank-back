(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[102],{7270:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/trafico",function(){return n(1473)}])},1473:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return x}});var r=n(4051),a=n.n(r),o=n(5893),c=n(7294),i=n(2351),u=n(3369),s=n(7590),f=n(649),d=n(381),l=n.n(d),h=n(1242),p=n(282);function m(t,e,n,r,a,o,c){try{var i=t[o](c),u=i.value}catch(s){return void n(s)}i.done?e(u):Promise.resolve(u).then(r,a)}function v(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function c(t){m(o,r,a,c,i,"next",t)}function i(t){m(o,r,a,c,i,"throw",t)}c(void 0)}))}}function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var b=null;function x(t){t=null!==t?t:function(t){throw t}(new TypeError("Cannot destructure undefined"));var e=function(){for(var t="0123456789ABCDEF".split(""),e="#",n=0;n<6;n++)e+=t[Math.floor(16*Math.random())];return e},n=(0,c.useState)({fechaFrom:l()().format("MM/DD/YYYY"),fechaTo:l()().format("MM/DD/YYYY"),tipo:"D\xedas"}),r=n[0],d=n[1],m=(0,c.useState)([]),x=m[0],Y=m[1],D=(0,c.useState)(!1),w=D[0],M=D[1],y=(0,c.useState)([]),k=(y[0],y[1]),j=function(){var t=v(a().mark((function t(){var e;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,Y([]),k([]),M(!0),t.next=6,(0,f.j0)("/api/admin/reporte-trasacciones",r);case 6:if((e=t.sent).ok){t.next=10;break}return M(!1),t.abrupt("return");case 10:Y(e.data.transacciones),M(!1),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(0),M(!1),console.log(t.t0);case 18:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(){return t.apply(this,arguments)}}(),C=(0,c.useMemo)((function(){if("D\xedas"===r.tipo){var t=x.map((function(t){return l()(t.fecha).format("DD/MM/YYYY")})).reduce((function(t,e){return t[e]=t[e]+1||1,t}),{}),e=[];for(var n in t)e.push([n,t[n]]);return e}var a=x.map((function(t){return l()(t.fecha).format("HH")})).reduce((function(t,e){return t[e]=t[e]+1||1,t}),{}),o=[];for(var c in a)o.push([c,a[c]]);return o}),[r.tipo,x]),P=(0,c.useMemo)((function(){return"D\xedas"===r.tipo?["D\xeda","Cantidad Transacciones"]:["Hora","Cantidad Transacciones"]}),[r.tipo]),_=(0,c.useMemo)((function(){if("D\xedas"===r.tipo){var t=x.map((function(t){return l()(t.fecha).format("DD/MM/YYYY")})).reduce((function(t,e){return t[e]=t[e]+1||1,t}),{}),e=[];for(var n in t)e.push(n);return e}var a=x.map((function(t){return l()(t.fecha).format("HH")})).reduce((function(t,e){return t[e]=t[e]+1||1,t}),{}),o=[];for(var c in a)o.push(c);return o}),[r.tipo,x]),T=(0,c.useMemo)((function(){if("D\xedas"===r.tipo){var t=x.map((function(t){return l()(t.fecha).format("DD/MM/YYYY")})).reduce((function(t,e){return t[e]=t[e]+1||1,t}),{}),n=[],a=[],o=[];for(var c in t)n.push(c),a.push(t[c]),o.push(e());var i=[];return n.length>0&&(i=[{label:["Transacciones"],data:a,backgroundColor:o,borderColor:[],borderWidth:1}]),i}var u=x.map((function(t){return l()(t.fecha).format("HH")})).reduce((function(t,e){return t[e]=t[e]+1||1,t}),{}),s=[],f=[],d=[];for(var h in u)s.push(h),f.push(u[h]),d.push(e());var p=[];return s.length>0&&(p=[{label:["Transacciones"],data:f,backgroundColor:d,borderColor:[],borderWidth:1}]),p}),[r.tipo,x]);function E(){return(E=v(a().mark((function t(e){var n,o,c,i,u,s,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(t.prev=0,(n=new b("landscape")).text(240,15,l()().format("DD/MM/YYYY - hh:mm")),n.setFontSize(40),n.text(75,15,"Dakiti Administradores",{align:"center"}),n.setFontSize(26),n.text(150,47,"Reporte de tr\xe1fico (".concat(r.tipo,")"),{align:"center"}),n.setFontSize(16),n.text(25,60,"Fecha u Hora",{align:"center",maxWidth:100}),n.text(100,60,"Cantidad",{align:"center",maxWidth:100}),o=70,20,c=0,0,i=0;i<C.length;i++)n.text(25,o+20*(i-c),"".concat(C[i][0]),{align:"center",maxWidth:100}),n.text(100,o+20*(i-c),"".concat(C[i][1]),{align:"center",maxWidth:100}),o+20*(i-c)>180&&(n.addPage(),o=5,c=i),o+20*(i-c);return n.addPage(),u=document.getElementById("nodo-graficas"),t.next=19,domtoimage.toPng(u);case 19:s=t.sent,(f=new Image).src=s,n.setFontSize(40),n.text(60,15,"Gr\xe1ficas resumen",{align:"center"}),n.addImage(f,"JPEG",10,30),n.save("Reporte de tr\xe1fico (".concat(r.tipo,")_").concat(l()().format("DD/MM/YYYY-hh:mm"),".pdf")),t.next=31;break;case 28:t.prev=28,t.t0=t.catch(0),console.log(t.t0);case 31:case"end":return t.stop()}}),t,null,[[0,28]])})))).apply(this,arguments)}return(0,o.jsxs)(i.Z,{children:[(0,o.jsx)(u.A,{filtersForm:r,handleFormChange:function(t){var e=t.target.name,n=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){g(t,e,n[e])}))}return t}({},r);n[e]=t.target.value,d(n)},submitConsulta:j}),(0,o.jsx)("div",{style:{textAlign:"right",marginTop:10},children:(0,o.jsx)(p.Z,{className:"medium-button blue-background",onClick:function(t){return E.apply(this,arguments)},children:"Descargar PDF"})}),(0,o.jsx)("div",{style:{height:"calc(100vh - 230px)",marginTop:10},children:(0,o.jsx)(s.Z,{headers:P,data:C,loading:w,paginate:!0})}),(0,o.jsx)("div",{style:{height:"calc(100vh - 230px)",marginTop:10},children:(0,o.jsx)(h.Z,{labels:_,datasets:T})})]})}n.e(323).then(n.t.bind(n,2617,23)).then((function(t){b=t.default}))}},function(t){t.O(0,[885,570,778,813,426,254,617,774,888,179],(function(){return e=7270,t(t.s=e);var e}));var e=t.O();_N_E=e}]);